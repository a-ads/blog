variables:
  S3_BUCKET_NAME: "a-ads-blog"

image: node:8-alpine

deploy:
  script:
    - apk add --update --no-cache --repository https://dl-3.alpinelinux.org/alpine/edge/main/ libpng-dev fftw-dev build-base
    - apk add --update --no-cache --repository https://dl-3.alpinelinux.org/alpine/edge/testing/ vips-dev
    - npm install yarn gatsby
    - node_modules/.bin/yarn install
    - node_modules/.bin/gatsby build --prefix-paths
    - apk add --no-cache --update python3
    - pip3 install awscli
    - aws s3 cp ./public/ s3://$S3_BUCKET_NAME/blog/ --recursive --acl public-read
  only:
    - master
